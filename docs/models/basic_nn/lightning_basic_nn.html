<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
<meta name="generator" content="pdoc3 0.11.5">
<title>ml4opf.models.basic_nn.lightning_basic_nn API documentation</title>
<meta name="description" content="">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/sanitize.min.css" integrity="sha512-y1dtMcuvtTMJc1yPgEqF0ZjQbhnc/bFhyvIyVNb9Zk5mIGtqVaAB1Ttl28su8AvFMOY0EwRbAe+HCLqj6W7/KA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/13.0.0/typography.min.css" integrity="sha512-Y1DYSb995BAfxobCkKepB1BqJJTPrOp3zPL74AWFugHHmmdcvO+C48WLrUOlhGMc0QG7AE3f7gmvvcrmX2fDoA==" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:1.5em;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:2em 0 .50em 0}h3{font-size:1.4em;margin:1.6em 0 .7em 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .2s ease-in-out}a:visited{color:#503}a:hover{color:#b62}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900;font-weight:bold}pre code{font-size:.8em;line-height:1.4em;padding:1em;display:block}code{background:#f3f3f3;font-family:"DejaVu Sans Mono",monospace;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source > summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible;min-width:max-content}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em 1em;margin:1em 0}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul ul{padding-left:1em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => {
hljs.configure({languages: ['bash', 'css', 'diff', 'graphql', 'ini', 'javascript', 'json', 'plaintext', 'python', 'python-repl', 'rust', 'shell', 'sql', 'typescript', 'xml', 'yaml']});
hljs.highlightAll();
/* Collapse source docstrings */
setTimeout(() => {
[...document.querySelectorAll('.hljs.language-python > .hljs-string')]
.filter(el => el.innerHTML.length > 200 && ['"""', "'''"].includes(el.innerHTML.substring(0, 3)))
.forEach(el => {
let d = document.createElement('details');
d.classList.add('hljs-string');
d.innerHTML = '<summary>"""</summary>' + el.innerHTML.substring(3);
el.replaceWith(d);
});
}, 100);
})</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>ml4opf.models.basic_nn.lightning_basic_nn</code></h1>
</header>
<section id="section-intro">
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN"><code class="flex name class">
<span>class <span class="ident">BasicNN</span></span>
<span>(</span><span>opfmodel: <a title="ml4opf.formulations.model.OPFModel" href="../../formulations/model.html#ml4opf.formulations.model.OPFModel">OPFModel</a>,<br>slices: list[slice],<br>optimizer: str = 'adam',<br>loss: str = 'mse',<br>hidden_sizes: list[int] = [100, 100],<br>activation: str = 'relu',<br>boundrepair: str = 'none',<br>learning_rate: float = 0.001,<br>weight_init_seed: int = 42)</span>
</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L13-L139" class="git-link">Browse git</a></div>
<div class="desc"><p>Hooks to be used in LightningModule.</p></div>
<h3>Ancestors</h3>
<ul class="hlist">
<li>pytorch_lightning.core.module.LightningModule</li>
<li>lightning_fabric.utilities.device_dtype_mixin._DeviceDtypeModuleMixin</li>
<li>pytorch_lightning.core.mixins.hparams_mixin.HyperparametersMixin</li>
<li>pytorch_lightning.core.hooks.ModelHooks</li>
<li>pytorch_lightning.core.hooks.DataHooks</li>
<li>pytorch_lightning.core.hooks.CheckpointHooks</li>
<li>torch.nn.modules.module.Module</li>
</ul>
<h3>Subclasses</h3>
<ul class="hlist">
<li><a title="ml4opf.models.basic_nn.acopf_basic_nn.ACBasicNN" href="acopf_basic_nn.html#ml4opf.models.basic_nn.acopf_basic_nn.ACBasicNN">ACBasicNN</a></li>
<li><a title="ml4opf.models.basic_nn.dcopf_basic_nn.DCBasicNN" href="dcopf_basic_nn.html#ml4opf.models.basic_nn.dcopf_basic_nn.DCBasicNN">DCBasicNN</a></li>
<li><a title="ml4opf.models.basic_nn.ed_basic_nn.EDBasicNN" href="ed_basic_nn.html#ml4opf.models.basic_nn.ed_basic_nn.EDBasicNN">EDBasicNN</a></li>
<li><a title="ml4opf.models.basic_nn.socopf_basic_nn.SOCBasicNN" href="socopf_basic_nn.html#ml4opf.models.basic_nn.socopf_basic_nn.SOCBasicNN">SOCBasicNN</a></li>
<li><a title="ml4opf.models.ldf_nn.ldf_nn.LDFNN" href="../ldf_nn/ldf_nn.html#ml4opf.models.ldf_nn.ldf_nn.LDFNN">LDFNN</a></li>
<li><a title="ml4opf.models.pca_nn.pca_nn.PCANN" href="../pca_nn/pca_nn.html#ml4opf.models.pca_nn.pca_nn.PCANN">PCANN</a></li>
<li><a title="ml4opf.models.penalty_nn.penalty_nn.PenaltyNN" href="../penalty_nn/penalty_nn.html#ml4opf.models.penalty_nn.penalty_nn.PenaltyNN">PenaltyNN</a></li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.opfmodel"><code class="name">var <span class="ident">opfmodel</span> : <a title="ml4opf.formulations.model.OPFModel" href="../../formulations/model.html#ml4opf.formulations.model.OPFModel">OPFModel</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.violation"><code class="name">var <span class="ident">violation</span> : <a title="ml4opf.formulations.violation.OPFViolation" href="../../formulations/violation.html#ml4opf.formulations.violation.OPFViolation">OPFViolation</a></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.input_size"><code class="name">prop <span class="ident">input_size</span> : int</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L51-L53" class="git-link">Browse git</a></div>
<div class="desc"></div>
</dd>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.output_size"><code class="name">prop <span class="ident">output_size</span> : int</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L55-L57" class="git-link">Browse git</a></div>
<div class="desc"></div>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.add_boundrepair"><code class="name flex">
<span>def <span class="ident">add_boundrepair</span></span>(<span>self, boundrepair: str)</span>
</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L47-L49" class="git-link">Browse git</a></div>
<div class="desc"></div>
</dd>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.configure_optimizers"><code class="name flex">
<span>def <span class="ident">configure_optimizers</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L119-L120" class="git-link">Browse git</a></div>
<div class="desc"><p>Choose what optimizers and learning-rate schedulers to use in your optimization. Normally you'd need one.
But in the case of GANs or similar you might have multiple. Optimization with multiple optimizers only works in
the manual optimization mode.</p>
<h2 id="return">Return</h2>
<p>Any of these 6 options.</p>
<ul>
<li><strong>Single optimizer</strong>.</li>
<li><strong>List or Tuple</strong> of optimizers.</li>
<li><strong>Two lists</strong> - The first list has multiple optimizers, and the second has multiple LR schedulers
(or multiple <code>lr_scheduler_config</code>).</li>
<li><strong>Dictionary</strong>, with an <code>"optimizer"</code> key, and (optionally) a <code>"lr_scheduler"</code>
key whose value is a single LR scheduler or <code>lr_scheduler_config</code>.</li>
<li><strong>None</strong> - Fit will run without any optimizer.</li>
</ul>
<p>The <code>lr_scheduler_config</code> is a dictionary which contains the scheduler and its associated configuration.
The default configuration is shown below.</p>
<p>.. code-block:: python</p>
<pre><code>lr_scheduler_config = {
    # REQUIRED: The scheduler instance
    "scheduler": lr_scheduler,
    # The unit of the scheduler's step size, could also be 'step'.
    # 'epoch' updates the scheduler on epoch end whereas 'step'
    # updates it after a optimizer update.
    "interval": "epoch",
    # How many epochs/steps should pass between calls to
    # &lt;code&gt;scheduler.step()&lt;/code&gt;. 1 corresponds to updating the learning
    # rate after every epoch/step.
    "frequency": 1,
    # Metric to to monitor for schedulers like &lt;code&gt;ReduceLROnPlateau&lt;/code&gt;
    "monitor": "val_loss",
    # If set to &lt;code&gt;True&lt;/code&gt;, will enforce that the value specified 'monitor'
    # is available when the scheduler is updated, thus stopping
    # training if not found. If set to &lt;code&gt;False&lt;/code&gt;, it will only produce a warning
    "strict": True,
    # If using the &lt;code&gt;LearningRateMonitor&lt;/code&gt; callback to monitor the
    # learning rate progress, this keyword can be used to specify
    # a custom logged name
    "name": None,
}
</code></pre>
<p>When there are schedulers in which the <code>.step()</code> method is conditioned on a value, such as the
:class:<code>torch.optim.lr_scheduler.ReduceLROnPlateau</code> scheduler, Lightning requires that the
<code>lr_scheduler_config</code> contains the keyword <code>"monitor"</code> set to the metric name that the scheduler
should be conditioned on.</p>
<div class="admonition testcode">
<p class="admonition-title">Testcode</p>
<h1 id="the-reducelronplateau-scheduler-requires-a-monitor">The ReduceLROnPlateau scheduler requires a monitor</h1>
<p>def configure_optimizers(self):
optimizer = Adam(&hellip;)
return {
"optimizer": optimizer,
"lr_scheduler": {
"scheduler": ReduceLROnPlateau(optimizer, &hellip;),
"monitor": "metric_to_track",
"frequency": "indicates how often the metric is updated",
# If "monitor" references validation metrics, then "frequency" should be set to a
# multiple of "trainer.check_val_every_n_epoch".
},
}</p>
<h1 id="in-the-case-of-two-optimizers-only-one-using-the-reducelronplateau-scheduler">In the case of two optimizers, only one using the ReduceLROnPlateau scheduler</h1>
<p>def configure_optimizers(self):
optimizer1 = Adam(&hellip;)
optimizer2 = SGD(&hellip;)
scheduler1 = ReduceLROnPlateau(optimizer1, &hellip;)
scheduler2 = LambdaLR(optimizer2, &hellip;)
return (
{
"optimizer": optimizer1,
"lr_scheduler": {
"scheduler": scheduler1,
"monitor": "metric_to_track",
},
},
{"optimizer": optimizer2, "lr_scheduler": scheduler2},
)</p>
</div>
<p>Metrics can be made available to monitor by simply logging it using
<code>self.log('metric_to_track', metric_val)</code> in your :class:<code>~pytorch_lightning.core.LightningModule</code>.</p>
<h2 id="note">Note</h2>
<p>Some things to know:</p>
<ul>
<li>Lightning calls <code>.backward()</code> and <code>.step()</code> automatically in case of automatic optimization.</li>
<li>If a learning rate scheduler is specified in <code>configure_optimizers()</code> with key
<code>"interval"</code> (default "epoch") in the scheduler configuration, Lightning will call
the scheduler's <code>.step()</code> method automatically in case of automatic optimization.</li>
<li>If you use 16-bit precision (<code>precision=16</code>), Lightning will automatically handle the optimizer.</li>
<li>If you use :class:<code>torch.optim.LBFGS</code>, Lightning handles the closure function automatically for you.</li>
<li>If you use multiple optimizers, you will have to switch to 'manual optimization' mode and step them
yourself.</li>
<li>If you need to control how often the optimizer steps, override the :meth:<code>optimizer_step</code> hook.</li>
</ul></div>
</dd>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.forward"><code class="name flex">
<span>def <span class="ident">forward</span></span>(<span>self, x: torch.Tensor) ‑> Callable[..., Any]</span>
</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L116-L117" class="git-link">Browse git</a></div>
<div class="desc"><p>Same as :meth:<code>torch.nn.Module.forward</code>.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>*args</code></strong></dt>
<dd>Whatever you decide to pass into the forward method.</dd>
<dt><strong><code>**kwargs</code></strong></dt>
<dd>Keyword arguments are also possible.</dd>
</dl>
<h2 id="return">Return</h2>
<p>Your model's output</p></div>
</dd>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.init_weights"><code class="name flex">
<span>def <span class="ident">init_weights</span></span>(<span>self, weight_initializer=None, seed: int | None = 42)</span>
</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L77-L90" class="git-link">Browse git</a></div>
<div class="desc"></div>
</dd>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.make_network"><code class="name flex">
<span>def <span class="ident">make_network</span></span>(<span>self)</span>
</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L104-L114" class="git-link">Browse git</a></div>
<div class="desc"></div>
</dd>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.make_optimizer"><code class="name flex">
<span>def <span class="ident">make_optimizer</span></span>(<span>self, optimizer: str, learning_rate: float)</span>
</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L92-L101" class="git-link">Browse git</a></div>
<div class="desc"></div>
</dd>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.set_activation"><code class="name flex">
<span>def <span class="ident">set_activation</span></span>(<span>self, activation: str)</span>
</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L59-L66" class="git-link">Browse git</a></div>
<div class="desc"></div>
</dd>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.set_loss"><code class="name flex">
<span>def <span class="ident">set_loss</span></span>(<span>self, loss: str)</span>
</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L68-L75" class="git-link">Browse git</a></div>
<div class="desc"></div>
</dd>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.test_step"><code class="name flex">
<span>def <span class="ident">test_step</span></span>(<span>self, batch: tuple[torch.Tensor, torch.Tensor], _)</span>
</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L138-L139" class="git-link">Browse git</a></div>
<div class="desc"><p>Operates on a single batch of data from the test set. In this step you'd normally generate examples or
calculate anything of interest such as accuracy.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>batch</code></strong></dt>
<dd>The output of your data iterable, normally a :class:<code>~torch.utils.data.DataLoader</code>.</dd>
<dt><strong><code>batch_idx</code></strong></dt>
<dd>The index of this batch.</dd>
<dt><strong><code>dataloader_idx</code></strong></dt>
<dd>The index of the dataloader that produced this batch.
(only if multiple dataloaders used)</dd>
</dl>
<h2 id="return">Return</h2>
<ul>
<li>:class:<code>~torch.Tensor</code> - The loss tensor</li>
<li><code>dict</code> - A dictionary. Can include any keys, but must include the key <code>'loss'</code>.</li>
<li><code>None</code> - Skip to the next batch.</li>
</ul>
<p>.. code-block:: python</p>
<pre><code># if you have one test dataloader:
def test_step(self, batch, batch_idx): ...


# if you have multiple test dataloaders:
def test_step(self, batch, batch_idx, dataloader_idx=0): ...
</code></pre>
<p>Examples::</p>
<pre><code># CASE 1: A single test dataset
def test_step(self, batch, batch_idx):
    x, y = batch

    # implement your own
    out = self(x)
    loss = self.loss(out, y)

    # log 6 example images
    # or generated text... or whatever
    sample_imgs = x[:6]
    grid = torchvision.utils.make_grid(sample_imgs)
    self.logger.experiment.add_image('example_images', grid, 0)

    # calculate acc
    labels_hat = torch.argmax(out, dim=1)
    test_acc = torch.sum(y == labels_hat).item() / (len(y) * 1.0)

    # log the outputs!
    self.log_dict({'test_loss': loss, 'test_acc': test_acc})
</code></pre>
<p>If you pass in multiple test dataloaders, :meth:<code>test_step</code> will have an additional argument. We recommend
setting the default value of 0 so that you can quickly switch between single and multiple dataloaders.</p>
<p>.. code-block:: python</p>
<pre><code># CASE 2: multiple test dataloaders
def test_step(self, batch, batch_idx, dataloader_idx=0):
    # dataloader_idx tells you which dataset this is.
    ...
</code></pre>
<h2 id="note">Note</h2>
<p>If you don't need to test you don't need to implement this method.</p>
<h2 id="note_1">Note</h2>
<p>When the :meth:<code>test_step</code> is called, the model has been put in eval mode and
PyTorch gradients have been disabled. At the end of the test epoch, the model goes back
to training mode and gradients are enabled.</p></div>
</dd>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.training_step"><code class="name flex">
<span>def <span class="ident">training_step</span></span>(<span>self, batch, _)</span>
</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L132-L133" class="git-link">Browse git</a></div>
<div class="desc"><p>Here you compute and return the training loss and some additional metrics for e.g. the progress bar or
logger.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>batch</code></strong></dt>
<dd>The output of your data iterable, normally a :class:<code>~torch.utils.data.DataLoader</code>.</dd>
<dt><strong><code>batch_idx</code></strong></dt>
<dd>The index of this batch.</dd>
<dt><strong><code>dataloader_idx</code></strong></dt>
<dd>The index of the dataloader that produced this batch.
(only if multiple dataloaders used)</dd>
</dl>
<h2 id="return">Return</h2>
<ul>
<li>:class:<code>~torch.Tensor</code> - The loss tensor</li>
<li><code>dict</code> - A dictionary which can include any keys, but must include the key <code>'loss'</code> in the case of
automatic optimization.</li>
<li><code>None</code> - In automatic optimization, this will skip to the next batch (but is not supported for
multi-GPU, TPU, or DeepSpeed). For manual optimization, this has no special meaning, as returning
the loss is not required.</li>
</ul>
<p>In this step you'd normally do the forward pass and calculate the loss for a batch.
You can also do fancier things like multiple forward passes or something model specific.</p>
<p>Example::</p>
<pre><code>def training_step(self, batch, batch_idx):
    x, y, z = batch
    out = self.encoder(x)
    loss = self.loss(out, x)
    return loss
</code></pre>
<p>To use multiple optimizers, you can switch to 'manual optimization' and control their stepping:</p>
<p>.. code-block:: python</p>
<pre><code>def __init__(self):
    super().__init__()
    self.automatic_optimization = False


# Multiple optimizers (e.g.: GANs)
def training_step(self, batch, batch_idx):
    opt1, opt2 = self.optimizers()

    # do training_step with encoder
    ...
    opt1.step()
    # do training_step with decoder
    ...
    opt2.step()
</code></pre>
<h2 id="note">Note</h2>
<p>When <code>accumulate_grad_batches</code> &gt; 1, the loss returned here will be automatically
normalized by <code>accumulate_grad_batches</code> internally.</p></div>
</dd>
<dt id="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.validation_step"><code class="name flex">
<span>def <span class="ident">validation_step</span></span>(<span>self, batch: tuple[torch.Tensor, torch.Tensor], _)</span>
</code></dt>
<dd>
<div class="git-link-div"><a href="https://github.com/AI4OPT/ML4OPF/blob/8f8e6125352203d112bba4c89092347fd7629c56/ml4opf/models/basic_nn/lightning_basic_nn.py#L135-L136" class="git-link">Browse git</a></div>
<div class="desc"><p>Operates on a single batch of data from the validation set. In this step you'd might generate examples or
calculate anything of interest like accuracy.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>batch</code></strong></dt>
<dd>The output of your data iterable, normally a :class:<code>~torch.utils.data.DataLoader</code>.</dd>
<dt><strong><code>batch_idx</code></strong></dt>
<dd>The index of this batch.</dd>
<dt><strong><code>dataloader_idx</code></strong></dt>
<dd>The index of the dataloader that produced this batch.
(only if multiple dataloaders used)</dd>
</dl>
<h2 id="return">Return</h2>
<ul>
<li>:class:<code>~torch.Tensor</code> - The loss tensor</li>
<li><code>dict</code> - A dictionary. Can include any keys, but must include the key <code>'loss'</code>.</li>
<li><code>None</code> - Skip to the next batch.</li>
</ul>
<p>.. code-block:: python</p>
<pre><code># if you have one val dataloader:
def validation_step(self, batch, batch_idx): ...


# if you have multiple val dataloaders:
def validation_step(self, batch, batch_idx, dataloader_idx=0): ...
</code></pre>
<p>Examples::</p>
<pre><code># CASE 1: A single validation dataset
def validation_step(self, batch, batch_idx):
    x, y = batch

    # implement your own
    out = self(x)
    loss = self.loss(out, y)

    # log 6 example images
    # or generated text... or whatever
    sample_imgs = x[:6]
    grid = torchvision.utils.make_grid(sample_imgs)
    self.logger.experiment.add_image('example_images', grid, 0)

    # calculate acc
    labels_hat = torch.argmax(out, dim=1)
    val_acc = torch.sum(y == labels_hat).item() / (len(y) * 1.0)

    # log the outputs!
    self.log_dict({'val_loss': loss, 'val_acc': val_acc})
</code></pre>
<p>If you pass in multiple val dataloaders, :meth:<code>validation_step</code> will have an additional argument. We recommend
setting the default value of 0 so that you can quickly switch between single and multiple dataloaders.</p>
<p>.. code-block:: python</p>
<pre><code># CASE 2: multiple validation dataloaders
def validation_step(self, batch, batch_idx, dataloader_idx=0):
    # dataloader_idx tells you which dataset this is.
    ...
</code></pre>
<h2 id="note">Note</h2>
<p>If you don't need to validate you don't need to implement this method.</p>
<h2 id="note_1">Note</h2>
<p>When the :meth:<code>validation_step</code> is called, the model has been put in eval mode
and PyTorch gradients have been disabled. At the end of validation,
the model goes back to training mode and gradients are enabled.</p></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="ml4opf.models.basic_nn" href="index.html">ml4opf.models.basic_nn</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN">BasicNN</a></code></h4>
<ul class="">
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.add_boundrepair" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.add_boundrepair">add_boundrepair</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.configure_optimizers" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.configure_optimizers">configure_optimizers</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.forward" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.forward">forward</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.init_weights" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.init_weights">init_weights</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.input_size" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.input_size">input_size</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.make_network" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.make_network">make_network</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.make_optimizer" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.make_optimizer">make_optimizer</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.opfmodel" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.opfmodel">opfmodel</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.output_size" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.output_size">output_size</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.set_activation" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.set_activation">set_activation</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.set_loss" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.set_loss">set_loss</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.test_step" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.test_step">test_step</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.training_step" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.training_step">training_step</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.validation_step" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.validation_step">validation_step</a></code></li>
<li><code><a title="ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.violation" href="#ml4opf.models.basic_nn.lightning_basic_nn.BasicNN.violation">violation</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.11.5</a>.</p>
</footer>
</body>
</html>
